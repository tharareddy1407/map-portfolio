<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Map Portfolio</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; width: 100%; }

    /* Simple right panel */
    #panel{
      position: fixed; right: 16px; top: 16px;
      width: 340px; max-width: calc(100% - 32px);
      background: white; border-radius: 12px; padding: 14px 14px;
      box-shadow: 0 12px 30px rgba(0,0,0,.15);
      font-family: Arial, sans-serif;
      display:none;
    }
    #panel h3{ margin: 0 0 8px; }
    #panel .close{ float:right; cursor:pointer; font-weight:bold; }
  </style>
</head>
<body>
  <div id="map"></div>

  <div id="panel">
    <span class="close" onclick="hidePanel()">Ã—</span>
    <h3 id="panelTitle"></h3>
    <div id="panelBody"></div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // ---------- Map setup ----------
    const map = L.map('map', { zoomControl: true }).setView([39.5, -98.35], 4); // USA center

    // Google-like basemap (Carto / OSM style)
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap &copy; CARTO'
    }).addTo(map);

    // ---------- "Destinations" ----------
    // Pick city coordinates where each pin lives
    const places = {
      projects:   { name: "Projects",   latlng: [34.0522, -118.2437], content: "Your featured projects + GitHub links." }, // LA
      resume:     { name: "Resume",     latlng: [39.7392, -104.9903], content: "Resume highlights + download button." },    // Denver
      skills:     { name: "Tech Skills",latlng: [32.7767,  -96.7970], content: "Python, SQL, AWS, Spark, etc." },          // Dallas
      experience: { name: "Experience", latlng: [40.7128,  -74.0060], content: "Work history, impact, metrics." },          // NYC
      contact:    { name: "Contact Me", latlng: [33.7490,  -84.3880], content: "Email, LinkedIn, GitHub." }                 // Atlanta
    };

    // ---------- Markers ----------
    const markerStyle = (color) => ({
      radius: 10, color: "#fff", weight: 2, fillColor: color, fillOpacity: 1
    });

    const pinColors = {
      projects:"#e74c3c", resume:"#3498db", skills:"#2ecc71", experience:"#9b59b6", contact:"#f1c40f"
    };

    const markers = {};
    Object.entries(places).forEach(([key, p]) => {
      markers[key] = L.circleMarker(p.latlng, markerStyle(pinColors[key]))
        .addTo(map)
        .bindTooltip(p.name, { direction: 'top', offset: [0,-8] })
        .on('click', () => travelTo(key));
    });

    // ---------- Car marker ----------
    // Use emoji or swap with an SVG icon if you want
    const carIcon = L.divIcon({
      html: `<div style="font-size:22px; transform: translate(-50%,-50%);">ðŸš—</div>`,
      className: '',
      iconSize: [0,0]
    });

    let car = L.marker(places.resume.latlng, { icon: carIcon }).addTo(map); // start position
    let animId = null;

    // ---------- Routes between destinations ----------
    // You can define routes for each click (from current place to target).
    // Simple straight-line interpolation works, or you can add midpoints for a curved/road feel.
    function buildRoute(fromLatLng, toLatLng){
      // Add a midpoint to make the travel look less "straight"
      const mid = [
        (fromLatLng[0] + toLatLng[0]) / 2 + 1.2,   // tweak for a pleasing curve
        (fromLatLng[1] + toLatLng[1]) / 2
      ];
      return [fromLatLng, mid, toLatLng];
    }

    let currentKey = "resume";

    // ---------- Travel animation ----------
    function travelTo(targetKey){
      if (targetKey === currentKey) {
        openPanel(targetKey);
        return;
      }

      // Cancel previous animation
      if (animId) cancelAnimationFrame(animId);

      const from = places[currentKey].latlng;
      const to   = places[targetKey].latlng;
      const route = buildRoute(from, to);

      // Draw route line (optional)
      if (window.routeLine) map.removeLayer(window.routeLine);
      window.routeLine = L.polyline(route, { weight: 4, opacity: 0.7 }).addTo(map);

      // Fit map to route (smooth)
      map.flyToBounds(window.routeLine.getBounds().pad(0.25), { duration: 0.9 });

      // Create many intermediate points for smooth movement
      const path = densify(route, 140); // 140 steps
      animateAlong(path, 1600, () => { // duration ms
        currentKey = targetKey;
        openPanel(targetKey);
      });
    }

    // Densify polyline points -> smooth motion
    function densify(points, steps){
      const out = [];
      for (let i = 0; i < points.length - 1; i++){
        const a = points[i], b = points[i+1];
        const segSteps = Math.floor(steps / (points.length - 1));
        for (let s = 0; s < segSteps; s++){
          const t = s / segSteps;
          out.push([a[0] + (b[0]-a[0]) * t, a[1] + (b[1]-a[1]) * t]);
        }
      }
      out.push(points[points.length - 1]);
      return out;
    }

    function animateAlong(path, durationMs, onDone){
      const start = performance.now();

      function frame(now){
        const t = Math.min((now - start) / durationMs, 1);
        const idx = Math.floor(t * (path.length - 1));
        car.setLatLng(path[idx]);

        // Optional: rotate car based on direction
        rotateCar(path, idx);

        if (t < 1) animId = requestAnimationFrame(frame);
        else {
          animId = null;
          onDone?.();
        }
      }
      animId = requestAnimationFrame(frame);
    }

    function rotateCar(path, idx){
      const a = path[idx];
      const b = path[Math.min(idx+1, path.length-1)];
      const angle = Math.atan2(b[1]-a[1], b[0]-a[0]) * (180/Math.PI); // approx
      const el = car.getElement();
      if (el) el.style.transform = `translate(-50%,-50%) rotate(${angle}deg)`;
    }

    // ---------- Panel ----------
    function openPanel(key){
      document.getElementById('panelTitle').innerText = places[key].name;
      document.getElementById('panelBody').innerHTML = `
        <p style="margin-top:0">${places[key].content}</p>
        <p><b>Tip:</b> Replace this text with your real section content.</p>
      `;
      document.getElementById('panel').style.display = 'block';
    }
    function hidePanel(){
      document.getElementById('panel').style.display = 'none';
    }

    // Open default
    openPanel("resume");
  </script>
</body>
</html>
